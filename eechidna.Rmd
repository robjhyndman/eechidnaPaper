---
title: "eechidna: Exploring Australian Election and Census Data"
author:
  - name: Dianne Cook
    affiliation: Monash University
    address:
    - Department of Econometrics and Business Statistics
    - Clayton, VIC 3800, Australia
    email:  dicook@monash.edu
  - name: Anthony Ebert
    affiliation: Queensland University of Technology
    address: Australia
    email: anthonyebert@gmail.com
  - name: Heike Hofmann
    affiliation: Iowa State University
    address: USA
    email: hofmann@iastate.edu
  - name: Rob J Hyndman
    affiliation: Monash University
    address:
    - Department of Econometrics and Business Statistics
    - Clayton, VIC 3800, Australia
    email:  Rob.Hyndman@monash.edu
  - name: Thomas Lumley
    affiliation: University of Auckland
    address: New Zealand
    email: t.lumley@auckland.ac.nz
  - name: Ben Marwick
    affiliation: University of Washington
    address: USA
    email: bmarwick@uow.edu.au
  - name: Carson Sievert
    affiliation: Plotly
    address: USA
    email: cpsievert1@gmail.com
  - name: Mingzhu Sun
    affiliation: University of Queensland
    address: Australia
    email: m.sun1@uq.edu.au
  - name: Dilini Talagala
    affiliation: Monash University
    address:
    - Department of Econometrics and Business Statistics
    - Clayton, VIC 3800, Australia
    email: Dilini.Talagala@monash.edu
  - name: Nicholas Tierney
    affiliation: Queensland University of Technology
    address: Australia
    email: nicholas.tierney@gmail.com
  - name: Nathaniel Tomasetti
    affiliation: Monash University
    address:
    - Department of Econometrics and Business Statistics
    - Clayton, VIC 3800, Australia
    email: Nathaniel.Tomasetti@monash.edu
  - name: Earo Wang
    affiliation: Monash University
    address:
    - Department of Econometrics and Business Statistics
    - Clayton, VIC 3800, Australia
    email:  Earo.Wang@monash.edu
  - name: Fang Zhou
    affiliation: Microsoft
    address: Singapore
    email: Fang.Zhou@microsoft.com

abstract: >
  An abstract of less than 150 words.
bibliography: RJreferences.bib
output: rticles::rjournal_article
fig_caption: yes
fig_height: 5
fig_width: 8
includes:
  in_header: preamble.tex
keep_tex: yes
number_sections: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE)
# Make sure you have rticles installed.
library(eechidna)
library(ggplot2)
library(magrittr)
```


#Introduction


The `eechidna` package for R \citep{R} provides data from the 2013 and 2016 Australian Federal Elections and the 2011 and 2016 Australian Censuses for each House of Representatives electorate, along with some tools for visualizing and analysing the data. The name of the package is an acronym for ``Exploring Election and Census Highly Informative Data Nationally for Australia'', and is an allusion to the echidna, an Australian egg-laying marsupial.

This package was initially developed during the rOpenSci auunconf event in Brisbane, Queensland, during 21--22 April 2016. It was later updated during another rOpenSci auunconf in Brisbane on 31 March--1 April 2017.

The `nzelect` \citep{nzelect} package was an important inspiration for this pack


#Data

## Election Data

The data for the 2013 and 2016 Australian Federal Elections for the House of Representative were obtained from \url{http://results.aec.gov.au/}. These data are copyright Commonwealth of Australia (Australian Electoral Commission) 2013, 2016.

In the `eechidna` package we have eight election datasets:

\begin{table}[htb]\centering
\begin{tabular}{ll}
\toprule
\bfseries Data object name & \bf Description \\
\midrule
\bfseries 2013 election\\ 
\verb|aec2013_fp|              & first preference votes for candidates at each polling place\\
\verb|aec2013_fp_electorate|   & first preference votes for candidates at each electorate\\
\verb|aec2013_2pp|             & two party preferred votes for candidates at each polling place\\
\verb|aec2013_2pp_electorate|  & two party preferred votes for candidates at each electorate\\
\bfseries 2016 election\\ 
\verb|aec2016_fp|              & first preference votes for candidates at each polling place\\
\verb|aec2016_fp_electorate|   & first preference votes for candidates at each electorate\\
\verb|aec2016_2pp|             & two party preferred votes for candidates at each polling place\\
\verb|aec2016_2pp_electorate|  & two party preferred votes for candidates at each electorate\\
\bottomrule
\end{tabular}
\caption{Australian Election Data sets.}
\end{table}

The 2013 data sets contains `r formatC(nrow(aec2013_fp), big.mark=",", drop0trailing=TRUE, format="f")` rows and `r ncol(aec2013_fp)` columns. The 2016 data sets contains `r formatC(nrow(aec2016_fp), big.mark=",", drop0trailing=TRUE, format="f")` rows and `r ncol(aec2016_fp)` columns. Note that some parties have slightly different names in different states. For example there is "The Nationals" and the "National Party". We've simplified the data by renaming some of the parties to the variant of the name that won the most votes. 

## Census Data

The 2011 and 2016 Australian Census data were obtained from the Australian Bureau of Statistics and are available in the package as `abs2011` and `abs2016`. These data frames contain 150 rows each, corresponding to the 150 electorates in the 2013 and 2016 Australian House of Representatives elections (\url{http://www.aec.gov.au/profiles/}). The `r ncol(abs2011)` columns in each data frame largely comprise demographic summaries of each electorate. These are summarized in Table \ref{abs2011}.


```{r make-data-dictionary, include = FALSE}
data_dictionary <- data.frame(
  Variable = paste("\\",colnames(abs2011),"|",sep=""),
  Details = c(
    "Commonwealth Electoral District identifier",
    "Name of electorate",
    "State containing electorate",
    "Total population of electorate",
    "Area of electorate in square kilometres",
    "Median income of people within electorate",
    "Percentage of people unemployed",
    "Percentage of people whose highest qualification is a Bachelor degree",
    "Percentage of people whose highest qualification is a postgraduate degree",
    "Percentage of people affiliated with the Christian religion (of all denominations)",
    "Percentage of people affiliated with the Catholic denomimation.",
    "Percentage of people affiliated with the Buddhist religion.",
    "Percentage of people affiliated with the Islam religion.",
    "Percentage of people affiliated with the Jewish religion. ",
    "Percentage of people with no religion.",
    "Percentage of people aged 0-4.",
    "Percentage of people aged 5-9.",
    "Percentage of people aged 15-19.",
    "Percentage of people aged 20-24.",
    "Percentage of people aged 25-34.",
    "Percentage of people aged 35-44.",
    "Percentage of people aged 45-54.",
    "Percentage of people aged 55-64.",
    "Percentage of people aged 65-74.",
    "Percentage of people aged 75-84.",
    "Percentage of people aged 85 or higher.",
    "Percentage of people born outside Australia.",
    "Percentage of people who are Indigenous",
    "Percentage of people who speak only English",
    "Percentage of people who speak a language other than English at home",
    "Percentage of people who are married",
    "Percentage of people who are in a de facto marriage",
    "Total number of families to total number of people (times 100)",
    "Percentage of people with home internet",
    "Percentage of dwellings not owned (either outright or with a mortgage)")
) # close data_frame
```

```{r display-data-dictionary, cache=FALSE, results="asis", message=FALSE}
xtable::xtable(data_dictionary,
               label="abs2011",
               caption="Variables from the 2011 Census Data.") %>%
print(type="latex",
  size="small",
  comment=FALSE,
  booktabs=TRUE,
  include.rownames=FALSE,
  sanitize.colnames.function =  function(x){paste0('\\textbf{', x, '}')
},
  sanitize.text.function =
function(str) gsub("\\", "\\verb|", str, fixed = TRUE))
```




 - raw and processed


#Examples. 

###Exploring the 2011 Census data

Plots from the vignette.



However, there are many age groups. To look at all of them at once, we can gather them into a dataframe ready for plotting using `tidyr`.

```{r}

library(tidyr)

abs2011 %>%
  select(starts_with("Age"), 
         Electorate) %>%
  gather(key = "Age",
         value = "Percent_in_electorate",
         -Electorate) %>% 
  ggplot(data = .,
         aes(x = reorder(Age, - Percent_in_electorate),
             y = Percent_in_electorate,
             colour = Age)) +
  geom_boxplot() + 
  coord_flip() + 
  theme_minimal() + 
  theme(legend.position = "none") +
  labs(x = "Age Groups",
       y = "% in Electorate")


```

## Income

```{r}

ggplot(data = abs2011,
       aes(x = MedianIncome)) + 
  geom_density(fill = "salmon",
               bw = "SJ",
               colour = NA) + 
  xlim(250,1100) +
  geom_rug(colour = "salmon") + 
  theme_minimal()
  
```


If you're intersted in getting a sense of the distribution of the data, you can add in the points to get a bit more of a sense on the distribution.

```{r}

ggplot(data = abs2011,
       aes(x = reorder(State, -MedianIncome),
           y = MedianIncome,
           colour = State)) + 
  geom_boxplot() + 
  geom_jitter(alpha = 0.35, 
              size = 2,
              width = 0.3) +
  theme_minimal() + 
  theme(legend.position = "none") + 
  labs(x = "State")

```

##### Bachelor and income

```{r}

ggplot(data = abs2011,
       aes(x = Bachelor,
           y = MedianIncome)) + 
  geom_point(colour = "steelblue",
             alpha = 0.75) + 
  theme_minimal()

```


## Postgraduate


```{r}

ggplot(data = abs2011,
       aes(x = reorder(State, -Postgraduate),
           y = Postgraduate,
           colour = State)) +
  geom_boxplot() +
  theme_minimal() +
  labs(x = "State") + 
  theme(legend.position = "none")

```

##### Postgraduate and income

```{r}

ggplot(data = abs2011,
       aes(x = Postgraduate,
           y = MedianIncome)) + 
  geom_point(colour = "steelblue",
             alpha = 0.75) + 
  theme_minimal()
  
```

##### Comparing income across Bachelors and postgraduate

```{r}

abs2011 %>%
  select(Postgraduate,
         Bachelor,
         MedianIncome) %>% 
  gather(key = "Education",
         value = "Prop_Educated",
         -MedianIncome) %>%
ggplot(data = ,
       aes(x = Prop_Educated,
           y = MedianIncome,
           colour = Education)) + 
  geom_point() + 
  geom_smooth() +
  theme_minimal() +
  scale_color_brewer(type = "qual", palette = "Set1")
  # theme(legend.position = "bottom",
  #       legend.direction = "vertical")

```

## Religion

Let's look at all of the religions

```{r}

abs2011 %>%
  select(Christianity,
         Catholic,
         Buddhism,
         Islam,
         Judaism,
         NoReligion) %>%
  gather(key = "ReligionType",
         value = "Percent") %>%
  ggplot(data = .,
         aes(x = reorder(ReligionType, -Percent),
             y = Percent,
             colour = ReligionType)) + 
  geom_boxplot() + 
  theme_minimal() + 
  theme(legend.position = "none") +
  coord_flip() + 
  labs(x = "Religion")
             

```

##### Christianity by State


```{r}

ggplot(data = abs2011,
       aes(x = reorder(State, -Christianity),
           y = Christianity,
           colour = State)) + 
  geom_boxplot() +
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip() + 
  labs(x = "State")
  
           

```

## Internet

```{r}

ggplot(data = abs2011,
       aes(x = Internet)) +
  geom_density(fill = "steelblue",
               bw = "SJ",
               colour = NA) + 
  geom_rug(colour = "steelblue") + 
  theme_minimal() + 
  labs(x = "% of electorate with Internet") +
  xlim(85, 100)

```


## Internet by state

```{r}

ggplot(data = abs2011,
       aes(x = reorder(State, -Internet),
           y = Internet,
           colour = State)) + 
  geom_boxplot() +
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip() + 
  labs(x = "State")

```


#Cartograms

#Shiny web app

#Discussion

Discussion about difficulties and futrue development

- what aec and abs could do better
- updating for future elections and censuses
- how this might be used



\bibliography{RJreferences}
